# abort script on any command that exit with a non zero value
set -e
declare -A versions
# version mapping from full version to short version
versions['1.8.5']='1.8'

for version in ${!versions[@]}; do
  echo "Package mongodb version:$version"

  if [[ `uname -a` =~ "x86_64" ]] ; then
    name="mongodb-linux-x86_64-$version"
    echo "Using 64-bit version"
  else
    name="mongodb-linux-i686-$version"
    echo "Using 32-bit version"
  fi

  archive=mongodb/$name.tgz

  if [[ -f $archive ]] ; then
    echo "Archive found"
  else
    echo "Archive not found"
    exit 1
  fi

  echo "Extracting archive..."
  tar xzf $archive

  if [[ $? != 0 ]] ; then
    echo "Cannot unpack mongodb"
    exit 1
  fi

  short_version=${versions[$version]}
  target=${BOSH_INSTALL_TARGET}/$short_version
  mkdir $target
  cp -a $name/* $target
done
