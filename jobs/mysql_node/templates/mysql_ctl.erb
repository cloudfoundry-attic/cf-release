#!/bin/bash
<%
supported_versions = properties.mysql_node.supported_versions
version = supported_versions[0]

case version
when '5.1'
  binary_dir  = '/var/vcap/packages/mysql'
  config_file = '/var/vcap/jobs/mysql_node/config/my.cnf'
when '5.5'
  binary_dir  = '/var/vcap/packages/mysql55'
  config_file = '/var/vcap/jobs/mysql_node/config/my55.cnf'
end
%>

case $1 in

  start)
    /var/vcap/jobs/mysql_node/bin/create_mysql_tmp_dir
    return_value=$?
    if [ $return_value -ne 0 ]; then
      echo "Failed to create mysql tmp directory"
      exit $return_value
    fi
    <%= "#{binary_dir}/libexec/mysql.server start #{config_file}" %>

    ;;

  stop)
    <%= "#{binary_dir}/libexec/mysql.server stop #{config_file}" %>

    ;;

  *)
    echo "Usage: mysql_ctl {start|stop}"

    ;;

esac
