---
port: 9022 # external CC port
pid_filename: /var/vcap/sys/run/cloud_controller_ng/cloud_controller_ng.pid
nats_uri: nats://<%= properties.nats.user %>:<%= properties.nats.password %>@<%= properties.nats.address %>:<%= properties.nats.port %>

external_domain: <%= properties.ccng.external_host || "api2" %>.<%= properties.domain %>
serving_domain: <%= properties.domain %>
local_route: <%= spec.networks.send(properties.networks.apps).ip %>

cc_partition: <%= properties.ccng.cc_partition || "ng" %>

bootstrap_admin_email: <%= properties.ccng.bootstrap_admin_email || "sre@vmware.com" %>

bulk_api:
  auth_user: <%= properties.ccng.bulk_api_user || "bulk_api" %>
  auth_password: <%= properties.ccng.bulk_api_password %>

nginx:
  use_nginx: <%= properties.ccng.use_nginx || true %>
  instance_socket: "/var/vcap/sys/run/cloud_controller_ng/cloud_controller.sock"

info:
  name: <%= properties.name || "vcap" %>
  build: <%= properties.build || "\"2222\"" %>
  version: <%= properties.version || 2 %>
  support_address: <%= properties.support_address || "http://support.cloudfoundry.com" %>
  description: <%= properties.description || "VMware's Cloud Application Platform" %>
  api_version: <%= properties.api_version || "2.0.0" %>
# TODO: put back once json schema is sorted out
# allow_debug: false

directories:
<% if properties.directories %>
  droplets: <%= properties.directories.droplets %>
  resources: <%= properties.directories.resources %>
  tmpdir: <%= properties.directories.tmpdir %>
<% else %>
  droplets: "/var/vcap/shared/droplets"
  resources: "/var/vcap/shared/resources"
  tmpdir: "/var/vcap/data/cloud_controller_ng/tmp"
<% end %>

logging:
  file: /var/vcap/sys/log/cloud_controller_ng/cloud_controller_ng.log
  <% if properties.syslog_aggregator %>
  syslog: vcap.cloud_controller_ng
  <% end %>
  level: <%= properties.ccng.logging_level || "info" %>

<% db = properties.ccdb_ng.databases.find { |db| db.tag == "cc" } %>
<% db_role = properties.ccdb_ng.roles.find { |role| role.tag == "admin" } %>
db:
  database: postgres://<%= db_role.name %>:<%= db_role.password %>@<%= properties.ccdb_ng.address %>:<%= properties.ccdb_ng.port %>/<%= db.name %>
  max_connections: <%= properties.ccdb_ng.max_connections || 32 %>
  pool_timeout: <%= properties.ccdb_ng.pool_timeout || 10 %>
  log_level: <%= properties.ccng.db_logging_level || "debug2" %>

<% if properties.vcap_redis %>
redis:
  host: <%= properties.vcap_redis.address %>
  port: <%= properties.vcap_redis.port %>
  password: <%= properties.vcap_redis.password %>
<% end %>

uaa:
  url: http://uaa.<%= properties.domain %>
  resource_id: <%= properties.ccng.uaa_resource_id %>
  symmetric_secret: <%= properties.uaa.cc.token_secret %>

quota_manager:
<% if properties.ccng.quota_manager %>
  policy: <%= properties.ccng.quota_manager.policy %>
  base_url: <%= properties.ccng.quota_manager.base_url %>
  auth_token: <%= properties.ccng.quota_manager.auth_token %>
  http_timeout_sec: <%= properties.ccng.quota_manager.http_timeout_sec %>
<% else %>
  policy: "BlindApproval"
  base_url: ""
  auth_token: ""
  http_timeout_sec: 2
<% end %>

# App staging parameters
staging:
  max_staging_runtime: <%= properties.cc.max_staging_runtime || 120 %>
  auth:
    user: <%= properties.ccng.staging_upload_user %>
    password: <%= properties.ccng.staging_upload_password %>

# TODO: this will be removed when we do full runtime/framework
# db population when we work on real running app support
#
# The first entry in the runtimes array is the default runtime for that
# framework.

legacy_framework_manifest:
  grails:
    name: grails
    runtimes:
    - name: java
      version: "1.6"
      description: Java 6
    - name: java7
      version: "1.7"
      description: Java 7
    appservers:
    - name: tomcat
      description: Tomcat
    detection:
    - "*.war": true
  java_web:
    name: java_web
    runtimes:
    - name: java
      version: "1.6"
      description: Java 6
    - name: java7
      version: "1.7"
      description: Java 7
    appservers:
    - name: tomcat
      description: Tomcat
    detection:
    - "*.war": true
  lift:
    name: lift
    runtimes:
    - name: java
      version: "1.6"
      description: Java 6
    - name: java7
      version: "1.7"
      description: Java 7
    appservers:
    - name: tomcat
      description: Tomcat
    detection:
    - "*.war": true
  node:
    name: node
    runtimes:
    - name: node08
      version: 0.8.2
      description: Node.js
    - name: node06
      version: 0.6.8
      description: Node.js
    - name: node
      version: 0.4.12
      description: Node.js
    appservers: []

    detection:
    - "*.js": .
  rack:
    name: rack
    runtimes:
    - name: ruby18
      version: 1.8.7
      description: Ruby 1.8.7
    - name: ruby19
      version: 1.9.2p180
      description: Ruby 1.9.2
    appservers:
    - name: thin
      description: Thin
    detection:
    - config.ru: true
    - config/environment.rb: false
  rails3:
    name: rails3
    runtimes:
    - name: ruby18
      version: 1.8.7
      description: Ruby 1.8.7
    - name: ruby19
      version: 1.9.2p180
      description: Ruby 1.9.2
    appservers:
    - name: thin
      description: Thin
    detection:
    - config/application.rb: true
    - config/environment.rb: true
  sinatra:
    name: sinatra
    runtimes:
    - name: ruby18
      version: 1.8.7
      description: Ruby 1.8.7
    - name: ruby19
      version: 1.9.2p180
      description: Ruby 1.9.2
    appservers:
    - name: thin
      description: Thin
    detection:
    - "*.rb": require 'sinatra'|require "sinatra"
    - config.ru: false
    - config/environment.rb: false
  spring:
    name: spring
    runtimes:
    - name: java
      version: "1.6"
      description: Java 6
    - name: java7
      version: "1.7"
      description: Java 7
    appservers:
    - name: tomcat
      description: Tomcat
    detection:
    - "*.war": true
  standalone:
    name: standalone
    runtimes:
    - name: ruby18
      version: 1.8.7
      description: Ruby 1.8.7
    - name: ruby19
      version: 1.9.2p180
      description: Ruby 1.9.2
    - name: java
      version: "1.6"
      description: Java 6
    - name: java7
      version: "1.7"
      description: Java 7
    - name: node
      version: 0.4.12
      description: Node.js
    - name: node06
      version: 0.6.8
      description: Node.js
    - name: node08
      version: 0.8.2
      description: Node.js
    appservers: []
    detection:
