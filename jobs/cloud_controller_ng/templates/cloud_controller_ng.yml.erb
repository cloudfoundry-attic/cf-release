---
local_route: <%= spec.networks.send(properties.networks.apps).ip %>
port: 9022 # external CC port
pid_filename: /var/vcap/sys/run/cloud_controller_ng/cloud_controller_ng.pid
nats_uri: nats://<%= p("nats.user") %>:<%= p("nats.password") %>@<%= p("nats.address") %>:<%= p("nats.port") %>

external_domain: <%= p("ccng.external_host", "api2") %>.<%= p("domain") %>

<% system_domains = p("ccng.system_domains", [ p("domain") ]) %>
system_domains: [ <%= system_domains.join(", ") %> ]

cc_partition: <%= p("ccng.cc_partition", "ng") %>

bootstrap_admin_email: <%= p("ccng.bootstrap_admin_email", "sre@vmware.com") %>

bulk_api:
  auth_user: <%= p("ccng.bulk_api_user", "bulk_api") %>
  auth_password: <%= p("ccng.bulk_api_password") %>

service_lifecycle:
  max_upload_size: 1
  upload_token: <%= p("serialization_data_server.upload_token") %>
  upload_timeout: <%= p("serialization_data_server.upload_timeout") %>
  <% sds_port = p("serialization_data_server.port") %>
  serialization_data_server: <%= properties.service_lifecycle.serialization_data_server.map {|ip| "http://#{ip}:#{sds_port}" } %>

nginx:
  use_nginx: <%= p("ccng.use_nginx", true) %>
  instance_socket: "/var/vcap/sys/run/cloud_controller_ng/cloud_controller.sock"

info:
  name: <%= p("name", "vcap") %>
  build: <%= p("build", "\"2222\"") %>
  version: <%= p("version", 2) %>
  support_address: <%= p("support_address", "http://support.cloudfoundry.com") %>
  description: <%= p("description", "VMware's Cloud Application Platform") %>
  api_version: <%= p("api_version", "2.0.0") %>
# TODO: put back once json schema is sorted out
# allow_debug: false

<% if_p("directories.droplets",
        "directories.resources",
        "directories.staging_manifests",
        "directories.tmpdir") do |droplets, resources, staging_manifests, tmpdir| %>
directories:
 droplets: <%= droplets %>
 resources: <%= resources %>
 staging_manifests: <%= staging_manifests %>
 tmpdir: <%= tmpdir %>
<% end %>

logging:
  file: /var/vcap/sys/log/cloud_controller_ng/cloud_controller_ng.log
  <% if_p("syslog_aggregator") do |syslog_aggregator| %>
  syslog: vcap.cloud_controller_ng
  <% end %>
  level: <%= p("ccng.logging_level", "info") %>
  max_retries: <%= p("ccng.logging_max_retries", 1) %>

<% db = p("ccdb_ng.databases").find { |db| db["tag"] == "cc" } %>
<% db_role = p("ccdb_ng.roles").find { |role| role["tag"] == "admin" } %>
db:
  database: postgres://<%= db_role["name"] %>:<%= db_role["password"] %>@<%= p("ccdb_ng.address") %>:<%= p("ccdb_ng.port") %>/<%= db["name"] %>
  max_connections: <%= p("ccdb_ng.max_connections", 32) %>
  pool_timeout: <%= p("ccdb_ng.pool_timeout", 10) %>
  log_level: <%= p("ccng.db_logging_level", "debug2") %>

<% if_p("vcap_redis.address", "vcap_redis.port", "vcap_redis.password") do |address, port, password| %>
redis:
  host: <%= address %>
  port: <%= port %>
  password: <%= password %>
<% end %>

uaa:
  url: http://uaa.<%= p("domain") %>
  resource_id: <%= p("ccng.uaa_resource_id") %>
  symmetric_secret: <%= p("uaa.cc.token_secret") %>

# App staging parameters
staging:
  max_staging_runtime: <%= p("ccng.max_staging_runtime", 300) %>
  auth:
    user: <%= p("ccng.staging_upload_user") %>
    password: <%= p("ccng.staging_upload_password") %>

runtimes_file: /var/vcap/jobs/cloud_controller_ng/config/runtimes.yml

quota_definitions:
  free:
    non_basic_services_allowed: <%= p("ccng.quota_definitions.free.non_basic_services_allowed") %>
    total_services: <%= p("ccng.quota_definitions.free.total_services") %>
    free_memory_limit: <%= p("ccng.quota_definitions.free.free_memory_limit") %>
    paid_memory_limit: <%= p("ccng.quota_definitions.free.paid_memory_limit") %>
  paid:
    non_basic_services_allowed: <%= p("ccng.quota_definitions.paid.non_basic_services_allowed") %>
    total_services: <%= p("ccng.quota_definitions.paid.total_services") %>
    free_memory_limit: <%= p("ccng.quota_definitions.paid.free_memory_limit") %>
    paid_memory_limit: <%= p("ccng.quota_definitions.paid.paid_memory_limit") %>
  runaway:
    non_basic_services_allowed: <%= p("ccng.quota_definitions.runaway.non_basic_services_allowed") %>
    total_services: <%= p("ccng.quota_definitions.runaway.total_services") %>
    free_memory_limit: <%= p("ccng.quota_definitions.runaway.free_memory_limit") %>
    paid_memory_limit: <%= p("ccng.quota_definitions.runaway.paid_memory_limit") %>

default_quota_definition: <%= p("ccng.default_quota_definition") %>
